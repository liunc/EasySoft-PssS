@using EasySoft.PssS.Web.Resources;
@model EasySoft.PssS.Web.Models.User.LoginModel
@{
    Layout = "~/Views/Shared/_LayoutNoNav.cshtml";
}
<h2>@WebResource.Title_Login</h2>

<form role="form">
    <hr />
    <div class="form-group">
        <div class="input-group">
            <span class="input-group-addon"><span class="glyphicon glyphicon-phone"></span></span>
            <input class="form-control" id="txtMoblie" type="text" placeholder="@ValidateHelper.GetPleaseInputFieldString(WebResource.Field_Moblie)" />
        </div>
    </div>
    <div class="form-group">
        <div class="input-group">
            <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
            <input class="form-control" id="txtPassword" name="Password" type="password" placeholder="@ValidateHelper.GetPleaseInputFieldString(WebResource.Field_Password)" />
        </div>
    </div>
    <div class="form-group">
        <input id="btnLogin" type="submit" value="@WebResource.Button_Login" class="btn btn-success  btn-block" />
    </div>
</form>

@Html.Action("Dialog", "Common", new { id = "alertError", title = WebResource.Message_Error, messageBodyId = "errorMessage", firstButton = @WebResource.Button_Ok })

@section scripts {
    <script type="text/javascript">
        $(function () {
            $('#btnLogin').click(function () {
                $('#btnLogin').attr({ 'disabled': 'disabled' });
                var moblie = $.trim($('#txtMoblie').val());
                var password = $.trim($('#txtPassword').val());
                if (moblie.length == 0) {
                    showError('@ValidateHelper.GetPleaseInputFieldString(WebResource.Field_Moblie)');
                    return false;
                }
                if (password.length == 0) {
                    showError('@ValidateHelper.GetPleaseInputFieldString(WebResource.Field_Password)');
                    return false;
                }
                var model = {};
                model.Moblie = moblie;
                model.Password = password;
                model.ReturnUrl = '@Model.ReturnUrl';
                $.ajax({
                    type: 'post',
                    url: '/User/Login',
                    data: { model: model },
                    success: function (result) {
                        if (result.Result) {
                            window.location.href = result.Data;
                        }
                        else {
                            showError(result.Message);
                        }
                        return false;
                    },
                    error: function () {
                        showError('System Error');
                    }
                });
                return false;
            });
        });
        function showError(errorMessage) {
            $('#errorMessage').html(errorMessage);
            $('#alertError').modal('show');
            $('#btnLogin').removeAttr('disabled');
        }
    </script>
}


