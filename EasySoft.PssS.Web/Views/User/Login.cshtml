@using EasySoft.PssS.Web.Resources;

@{
    ViewBag.Title = WebResource.UserLogin_Title;
}
@{
    Layout = "~/Views/Shared/_LayoutNoNav.cshtml";
}
<div class="cart-panel">
    <form id="loginForm" class="am-form">
        <div class="am-form-group am-form-icon">
            <i class="am-icon-user" style="color:#329cd9"></i>
            <input id="txtMoblie" type="text" class="am-form-field" placeholder="@WebResource.UserLogin_MoblieTip">
        </div>
        <div class="am-form-group am-form-icon">
            <i class="am-icon-lock" style="color:#329cd9"></i>
            <input id="txtPassword" type="password" class="am-form-field" placeholder="@WebResource.UserLogin_PasswordTip">
        </div>
        @*<div class="am-checkbox">
                <label>
                    <input  type="checkbox"> 记住密码
                </label>
            </div>*@
        <p class="am-text-center"><button id="btnLogin" type="submit" class="am-btn am-btn-primary am-radius am-btn-block">@WebResource.UserLogin_LoginButton</button></p>

    </form>
</div>
<div class="am-modal am-modal-loading am-modal-no-btn" tabindex="-1" id="loading">
    <div class="am-modal-dialog">
        <div class="am-modal-hd">@WebResource.Message_Loading</div>
        <div class="am-modal-bd">
            <span class="am-icon-spinner am-icon-spin"></span>
        </div>
    </div>
</div>
<div class="am-modal am-modal-alert" tabindex="-1" id="alertError">
    <div class="am-modal-dialog">
        <div class="am-modal-bd" id="errorMessage">
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn">@WebResource.Button_Ok</span>
        </div>
    </div>
</div>
@section JsScripts {
    <script type="text/javascript">
        $(function () {
            $("#loading").bind("ajaxSend", function () {
                $(this).modal();
            }).ajaxComplete(function () {
                $(this).modal("close");
            });
            $("#btnLogin").click(function () {
                var moblie = $.trim($("#txtMoblie").val());
                var password = $.trim($("#txtPassword").val());
                if (moblie.length == 0) {
                    showError("@WebResource.UserLogin_MoblieTip");
                    return false;
                }
                if (password.length == 0) {
                    showError("@WebResource.UserLogin_PasswordTip");
                    return false;
                }
                var model = {};
                model.Moblie = moblie;
                model.Password = password;
                model.ReturnUrl = "@ViewBag.ReturnUrl";
                $.ajax({
                    type: 'post',
                    url: '/User/Login',
                    data: { model: model },
                    success: function (result) {
                        if (result.Result) {
                            window.location.href = result.Data;
                        }
                        else {
                            showError(result.Message);
                        }
                        return false;
                    }
                });
                return false;
            });
        });
        function showError(errorMessage) {
            $("#errorMessage").html(errorMessage);
            $("#alertError").modal();
            // setTimeout(function () { $("#alertError").modal("close"); }, 1000);
        }
    </script>
}


