@using EasySoft.PssS.Web.Resources;

@{
    ViewBag.Title = WebResource.User_Login_Title;
}
@{
    Layout = "~/Views/Shared/_LayoutNoNav.cshtml";
}
<div class="cart-panel">
    <form id="loginForm" class="am-form">
        <div class="am-form-group am-form-icon">
            <i class="am-icon-user" style="color:#329cd9"></i>
            <input id="txtMoblie" type="text" class="am-form-field" placeholder="@WebResource.User_Login_MoblieTip">
        </div>
        <div class="am-form-group am-form-icon">
            <i class="am-icon-lock" style="color:#329cd9"></i>
            <input id="txtPassword" type="password" class="am-form-field" placeholder="@WebResource.User_Login_PasswordTip">
        </div>
        @*<div class="am-checkbox">
                <label>
                    <input  type="checkbox"> 记住密码
                </label>
            </div>*@
        <p class="am-text-center"><button id="btnLogin" type="submit" class="am-btn am-btn-primary am-radius am-btn-block">@WebResource.User_Login_LoginButton</button></p>

    </form>
</div>
<div class="am-modal am-modal-alert" tabindex="-1" id="alertError">
    <div class="am-modal-dialog">
        <div class="am-modal-bd" id="errorMessage">
        </div>
        <div class="am-modal-footer">
            <span class="am-modal-btn">@WebResource.Button_Ok</span>
        </div>
    </div>
</div>
@section JsScripts {
    <script type="text/javascript">
        $(function () {

            $('#btnLogin').click(function () {
                $('#btnLogin').attr({ 'disabled': 'disabled' });
                var moblie = $.trim($('#txtMoblie').val());
                var password = $.trim($('#txtPassword').val());
                if (moblie.length == 0) {
                    showError("@WebResource.User_Login_MoblieTip");
                    return false;
                }
                if (password.length == 0) {
                    showError("@WebResource.User_Login_PasswordTip");
                    return false;
                }
                var model = {};
                model.Moblie = moblie;
                model.Password = password;
                model.ReturnUrl = "@ViewBag.ReturnUrl";
                $.ajax({
                    type: 'post',
                    url: '/User/Login',
                    data: { model: model },
                    success: function (result) {
                        if (result.Result) {
                            window.location.href = result.Data;
                        }
                        else {
                            showError(result.Message);
                        }
                        return false;
                    },
                    error: function () {
                        showError('System Error');
                    },
                    complete: function () {
                        $('#btnLogin').removeAttr('disabled');
                    }
                });
                return false;
            });
        });
        function showError(errorMessage) {
            $('#errorMessage').html(errorMessage);
            $('#alertError').modal();
        }
    </script>
}


